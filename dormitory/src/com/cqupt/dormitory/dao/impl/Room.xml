<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cqupt.dormitory.model.Room">
	<resultMap type="com.cqupt.dormitory.model.Room" id="roomResult">
		<id property="id" column="room_id"/>
		<result property="roomNum" column="room_num"/>
		<result property="totalBed" column="total_bed"/>
		<result property="cost" column="cost"/>
		<result property="alreadyStay" column="alreadstay"/><!-- 已经入住人数 -->
		<association property="floor" column="floor_id" resultMap="com.cqupt.dormitory.model.Floor.floorResult"/>
	</resultMap>
	
	<select id="findByRoomId" resultMap="roomResult" parameterType="String">
		SELECT * FROM `room` WHERE room_num = #{roomNum}
	</select>

	<select id="find_all_room_by_buildingnum" parameterType="string" resultMap="roomResult">
		SELECT 
		  COUNT(student.`stu_id`) AS alreadstay,
		  s.* 
		FROM
		  student 
		  RIGHT JOIN 
		    (SELECT 
		      room.*,
		      floor.`building_id`,
		      floor.`floor_num` 
		    FROM
		      room 
		      LEFT JOIN FLOOR
		        ON (
		          floor.`floor_id` = room.`floor_id`
		        ) 
		    WHERE room.`room_num` LIKE #{buildingNum}) s 
		    ON (s.room_id = student.`room_id`) 
		GROUP BY s.room_id 
		ORDER BY s.`floor_num`
	</select>
</mapper>